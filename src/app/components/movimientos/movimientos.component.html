<div class="movimientos container mt-4">
  <h2>Movimientos</h2>

  <!-- Formulario -->
  <form [formGroup]="form" (ngSubmit)="submit()" class="row g-3">
    <div class="col-md-4">
      <input 
        class="form-control" 
        formControlName="numeroCuenta" 
        placeholder="Número de cuenta" />
      <div *ngIf="form.controls['numeroCuenta'].invalid && form.controls['numeroCuenta'].touched">
        <small class="text-danger">Debes ingresar un número de cuenta válido.</small>
      </div>
    </div>

    <div class="col-md-3">
      <select class="form-select" formControlName="tipo">
        <option value="DEBITO">Débito</option>
        <option value="CREDITO">Crédito</option>
      </select>
    </div>

    <div class="col-md-3">
      <input 
        type="number" 
        class="form-control" 
        formControlName="valor" 
        placeholder="Valor" />
      <div *ngIf="form.controls['valor'].invalid && form.controls['valor'].touched">
        <small class="text-danger">El valor debe ser mayor que 0.</small>
      </div>
    </div>
    
    <div class="contenedor">
      <div class="hijo">
        <button 
          type="submit" 
          class="btn btn-primary flex-fill" 
          [disabled]="form.invalid">
          Crear
        </button>
        &nbsp;
        <button 
          type="button" 
          class="btn btn-success flex-fill" 
          (click)="generarReporte()">
          Descargar Reporte
        </button>
      </div>
    </div>
    
  </form>

  <!-- Tabla de movimientos -->
  <div class="mt-5">
    <h3>Histórico de Movimientos</h3>
    <table class="table table-striped mt-3" *ngIf="movimientos.length > 0">
      <thead class="table-dark">
        <tr>
          <th>Fecha</th>
          <th>Número Cuenta</th>
          <th>Tipo Cuenta</th>
          <th>Movimiento</th>
          <th>Numero Cliente</th>
          <th>Valor</th>
          <th>Saldo inicial</th>
          <th>Saldo disponible</th>
          <th>Estado</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let m of movimientos" (click)="seleccionarMovimiento(m)" style="cursor: pointer;" [class.table-active]="m === seleccionado">
          <td>{{ m.fecha | date:'dd/MM/yyyy HH:mm' }}</td>
          <td>{{ m.cuenta.numero }}</td>
          <td>{{ m.tipo }}</td>
          <td>{{ m.tipoMovimiento }}</td>
          <td>{{ m.cuenta.clienteId }}</td>
          <td>{{ m.valor | number:'1.2-2' }}</td>
          <td>{{ m.cuenta.saldoInicial | number:'1.2-2' }}</td>
          <td>{{ m.saldo | number:'1.2-2' }}</td>
          <td>{{ m.cuenta.estado }}</td>
        </tr>
      </tbody>
    </table>
    <p *ngIf="movimientos.length === 0" class="text-muted">No hay movimientos aún.</p>
  </div>
</div>
